<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mayb.NovelDocs.model.DocsMapper">
	<resultMap type="Directory" id="DirectoryResultMap" autoMapping="true">
		<id		column="name"		property="name"/>
		<id		column="parent"	property="parent"/>
		<id		column="reguser"	property="reguser"/>
		<result	column="dir_id"		property="dir_id"/>
		<result	column="regdate"	property="regdate"/>
	</resultMap>
	
	<select id="getSubdirectory" parameterType="Directory" resultMap="DirectoryResultMap">
		SELECT *
		FROM "DIRECTORY"
		WHERE PARENT = #{parent} AND REGUSER = #{reguser}
		ORDER BY NAME ASC
	</select>
	<insert id="createSubdirectory" parameterType="Directory">
		INSERT INTO DIRECTORY (DIR_ID, NAME, PARENT, REGUSER)
		VALUES (SELECT NVL(MAX(DIR_ID), 0) + 1 FROM "DIRECTORY" WHERE REGUSER = #{reguser}, #{name}, #{parent}, #{reguser})
	</insert>
	<select id="getConnectedDirectories" parameterType="Directory" resultMap="DirectoryResultMap">
		SELECT * FROM "DIRECTORY"
		WHERE REGUSER = #{reguser}
		START WITH PARENT = #{parent}
		CONNECT BY PRIOR (PARENT || NAME) = PARENT
	</select>
</mapper>